{%load  thumbnail i18n staticfiles herbs_tags %}
<!DOCTYPE html>
<html>
  <head>
    {%if curobj%}
    <title> {%trans "Гербарный объект"%} &mdash; ({{curobj.acronym.name}},{%if curobj.itemcode%}{{curobj.itemcode}}{%else%}*{%endif%}/{{curobj.pk}}): {{curobj.family.get_full_name|capfirst}}|{{curobj.species.get_full_name|capfirst}}</title> 
    <meta name="description" content="VBGI Herbarium object: {{curobj.species.get_full_name|capfirst}}">
    <meta name="keywords" content="{{curobj.family.name|capfirst}}, {{curobj.genus.name|capfirst}}, {{curobj.species.get_full_name|capfirst}},
          {%if curobj.country%}{{curobj.country}}{%endif%},
          {%if curobj.region%}{{curobj.region|force_translit}}{%endif%}">
    <meta name="author" content="{{curobj.collectedby|force_translit}}">
    {%else%}
    <title>{%trans "Гербарный образец с таким идентификатором не найден"%}</title>
    {%endif%}
   <meta charset="utf-8">
   <meta name="generator" content="Herbarium-app developed on top of the Django Framework">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <link rel="stylesheet" href="{%static "css/herbitems.css" %}" type="text/css" media="screen">
</head>
  <body>
  <div id="herbitem-main-container">
    <div id="herbitem-central-container">
      <div id="herbitem-our-heading">
        <div style="display:block"><a href="http://botsad.ru"> <img src="{%static "images/bgi_logo_white.png"%}" alt="{%trans "Перейти на главную старницу сайта"%} botsad.ru" width="35" height="35" style="float:left; display:block;"></a></div>
        {%trans "Ботанический сад-институт ДВО РАН"%}
        {%get_current_language as curlang%}
        <div class="herbitem-languages">
          <form action="" method="post">
            <button class="herbitem-ru-icon {%if curlang == "ru"%}herbitem-current-lang{%endif%}" name="lang" value="ru"></button>
          </form>
          <form action="" method="post">
            <button class="herbitem-en-icon {%if curlang == "en"%}herbitem-current-lang{%endif%}" name="lang" value="en"></button>
          </form>
        </div>
        <div style="clear:both"></div>   
      </div>  
      {%if not error%}
        {%if curobj.public %}
      <div id="herbitem-text-container"> 
      <p><strong>{%trans "Семейство"%}:</strong>&nbsp;{{curobj.species.genus.family.get_full_name|capfirst}}</p>
      <p><strong>{%trans "Род"%}:</strong>&nbsp;<i>{{curobj.species.genus.get_full_name|capfirst}}</i></p>
        {%if curobj.species %}<p><strong>{%trans "Вид"%}:</strong>&nbsp;<i>{{curobj.species.genus.name|capfirst}} {{curobj.species.name}}</i> {{curobj.species.authorship}} </p>{%endif%}
      {%if curobj.additionals.all%}
      <p><strong>{%trans "Дополнительные виды" %}:</strong></p>
      <ul>
        {%for item in curobj.additionals.all%}
          <li>{{item.identifiedby|force_translit}}: {{item.species}} {%trans "Валидность"%}: 
              {%if item.identified_s and item.identified_e%}{{item.identified_s}} &mdash; {{item.identified_e}}
              {%elif item.identified_s%} {%trans "с"%} {{item.identified_s}}
              {%elif item.identified_e%} {%trans "по"%} {{item.identified_e}}
              {%else%} {%trans "не задана"%}{%endif%}</li>
        {%endfor%}
      </ul>
      {%endif%}
      {%if curobj.coordinates.latitude and curobj.coordinates.longitude %}
      <p><strong>{%trans "Координаты сбора"%}:</strong></p>
      <p><strong>{%trans "Широта"%}:</strong> {{curobj.coordinates.latitude}}&deg;, &nbsp; 
      <strong>{%trans "Долгота"%}:</strong> {{curobj.coordinates.longitude}}&deg;</p>
       <div id="herbitem-map" style = "width: 90%; min-height: 300px;" data-lon = "{{curobj.coordinates.longitude|stringformat:"f"}}", data-lat = "{{curobj.coordinates.latitude|stringformat:"f" }}"></div>
       <script type="text/javascript">
          function initMap() {
            var markerpos = document.querySelector('#herbitem-map')
            var mpos = markerpos.dataset
            var herbsLatLng = {lat: parseFloat(mpos.lat) , lng: parseFloat(mpos.lon)};
            var herbsMap = new google.maps.Map(document.getElementById('herbitem-map'), {
              zoom: 4,
              center: herbsLatLng});
          var marker = new google.maps.Marker({
          position: herbsLatLng,
          map: herbsMap,
          title: "{%trans 'Место сбора'%}"
          });
          }
        </script>
        <script async defer src="//maps.googleapis.com/maps/api/js?signed_in=true&callback=initMap"></script>
        {%endif%}

      {%if curobj.country %}<p><strong>{%trans "Страна"%}:</strong>&nbsp;{{curobj.country|smart_language}}</p>{%endif%}
      {%if curobj.region %}<p><strong>{%trans "Регион"%}:</strong>&nbsp;{{curobj.region|smart_language|force_translit}}</p>{%endif%}
      {%if curobj.district %}<p><strong>{%trans "Район"%}:</strong>&nbsp;{{curobj.district|smart_language|force_translit}}</p>{%endif%}
      {%if curobj.detailed %}<p><strong>{%trans "Дополнительно"%}:</strong>&nbsp;{{curobj.detailed|smart_language}}</p>{%endif%}
      {%if curobj.altitude %}<p><strong>{%trans "Высота"%}:</strong>&nbsp;{{curobj.altitude|smart_language}}</p>{%endif%}
      {%if curobj.collectedby %}<p><strong>{%trans "Собрал(и)"%}:</strong>&nbsp;{{curobj.collectedby|force_translit}}</p>{%endif%}
      {%if curobj.colldate %}<p><strong>{%trans "Дата сбора"%}:</strong>&nbsp;{{curobj.collected_s}}{%if curobj.collected_e%} &mdash; {{curobj.collected_e}}{%endif%}</p>{%endif%}
      {%if curobj.identifiedby %}<p><strong>{%trans "Определил(и)"%}:</strong>&nbsp;{{curobj.identifiedby|force_translit}}</p>{%endif%}
      {%if curobj.detdate %}<p><strong>{%trans "Дата определения"%}:</strong>&nbsp; {{curobj.identified_s}}{%if curobj.identified_e%} &mdash; {{curobj.identified_e}}{%endif%}</p>{%endif%}

      {%if curobj.dethistory.all%}
      <p><strong>{%trans "История определений" %}:</strong></p>
      <ul>
        {%for item in curobj.dethistory.all%}
        <li>{{item.identifiedby|force_translit}}: {{item.species}} {%if item.identified_s and item.identified_e%} ({{item.identified_s}} &mdash; {{item.identified_e}}) {%elif item.identified_s%} ({{item.identified_s}}) {%elif item.identified_e%} ({{item.identified_e}}){%else%}{%endif%}</li>
        {%endfor%}
      </ul>
      {%endif%}
      {%if curobj.note %}<p><strong>{%trans "Примечание"%}:</strong>&nbsp;{{curobj.note|smart_language}}</p>{%endif%}
      <script type="text/javascript" > //make automatic queries for images
      var baseUrl = "{{base_herbitem_image_url}}"; //TODO: needs to be defined in the main view
      var acronym = "{{curobj.acronym.name}}";
      var theIDs = ["ID", "CODE"];
      var allowed_inds = [];
      var allowed_subinds = ["", "p"];
      var image=[]
      for (var i=1; i<{{max_herbitem_images}} + 1; i++){
      allowed_inds.push(i.toString());
      }
      // TODO: Get all valid urls of the current object.

      </script>
      <noscript>{%trans "Для корректного отображения изображений гербарных образцов должен быть включен JavaScript."%}</noscript>
      <p><i>{% trans "Последнее изменение"%}:</i>&nbsp;{{curobj.updated}}</p>
      </div>  
         {%else%}  
            <div id="herbitem-text-container" style="text-align: center">
              <h2>{%trans "Образец с номером "%}{{curobj.pk}} {%trans "не опубликован." %}</h2>
            </div>  
         {%endif%}
      {%else%}
      <div id="herbitem-text-container" style="text-align: center">
      <h2>{{error}}</h2>
      </div>  
      {%endif%}
      </div>  
      </div>
  </body>
</html>
